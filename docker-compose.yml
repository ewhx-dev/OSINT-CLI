version: "3.8"
services:
  redis:
    image: redis:7
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app
      - BING_API_KEY=${BING_API_KEY:-}
      - BING_ENDPOINT=${BING_ENDPOINT:-https://api.bing.microsoft.com/v7.0/search}
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis
    ports:
      - "8001:8001"
    volumes:
      - ./:/app

  gateway:
    build:
      context: .
      dockerfile: services/gateway/Dockerfile
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "8080:8080"
    volumes:
      - ./:/app

volumes:
  redis-data: